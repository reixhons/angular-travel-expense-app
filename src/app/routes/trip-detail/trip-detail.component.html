<div class="min-h-screen bg-gray-50 py-8">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-2xl shadow-sm p-8">
            <!-- Trip Header Section -->
            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">{{ trip?.name }}</h1>
                    <div class="flex items-center gap-3 mb-6">
                        <mat-form-field appearance="fill" class="w-40">
                            <mat-label>Expense Type</mat-label>
                            <mat-select [(ngModel)]="selectedExpenseType">
                                <mat-option value="" disabled selected>Expense Type</mat-option>
                                <mat-option value="FLIGHT">Flight</mat-option>
                                <mat-option value="HOTEL">Hotel</mat-option>
                                <mat-option value="CAR_RENTAL">Car Rental</mat-option>
                                <mat-option value="TAXI">Taxi</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <button mat-raised-button color="primary"
                            class="!rounded-xl !px-6 !py-2 !shadow-md hover:!shadow-lg transition-shadow"
                            [disabled]="!selectedExpenseType" (click)="addNewExpense()">
                            <mat-icon>add</mat-icon>
                            New Expense
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-gray-50 rounded-xl p-4 flex items-center gap-3">
                        <mat-icon class="text-gray-500">calendar_today</mat-icon>
                        <span class="text-gray-700">{{ getTripDuration(trip?.startDate, trip?.endDate) }} days</span>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-4 flex items-center gap-3">
                        <mat-icon class="text-gray-500">event</mat-icon>
                        <span class="text-gray-700">{{ trip?.startDate | date }} - {{ trip?.endDate | date }}</span>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-4 flex items-center gap-3">
                        <mat-icon class="text-gray-500">receipt_long</mat-icon>
                        <span class="text-gray-700">{{ expenses.length }} Expenses</span>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-4 flex items-center gap-3">
                        <mat-icon class="text-gray-500">attach_money</mat-icon>
                        <span class="text-gray-700">{{ getTotalCost() | currency }}</span>
                    </div>
                </div>
            </div>

            <!-- Trip Details Section -->
            <div class="mb-8 bg-white rounded-xl border border-gray-200 p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Trip Details</h2>
                <div class="flex flex-col gap-4">
                    <div class="flex items-center gap-4">
                        <strong class="text-gray-700">Status:</strong>
                        @if (trip?.status === 'DRAFT') {
                        <button mat-raised-button color="primary" class="!rounded-xl" (click)="updateTripStatus()">
                            <mat-icon>send</mat-icon>
                            Send for Approval
                        </button>
                        } @else {
                        <div [class]="'status-badge ' + getStatusClass(trip?.status || '')">
                            {{ trip?.status }}
                        </div>
                        }
                    </div>
                    @if (trip?.approverNote) {
                    <div class="bg-blue-50 rounded-lg p-4">
                        <strong class="text-blue-700">Approver Note:</strong>
                        <p class="mt-1 text-blue-600">{{ trip?.approverNote }}</p>
                    </div>
                    }
                </div>
            </div>

            <!-- Expenses Section -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Expenses</h2>
                <div class="space-y-4">
                    @for (expense of expenses; track expense.id) {
                    <div class="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div class="space-y-4 w-full">
                                <!-- Common Fields -->
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-medium text-gray-500">Type:</span>
                                    <span class="text-gray-900">{{ expense.type }}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-medium text-gray-500">Amount:</span>
                                    <span class="text-gray-900">{{ expense.totalPrice | currency }}</span>
                                </div>

                                <!-- Flight Specific Fields -->
                                @if (expense.type === 'FLIGHT') {
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-100 pt-4">
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Airline:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.airline }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Route:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.from }} â†’ {{ expense.to }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Departure:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.departureDateTime | date:'medium'
                                            }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Arrival:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.arrivalDateTime | date:'medium'
                                            }}</span>
                                    </div>
                                </div>
                                }

                                <!-- Hotel Specific Fields -->
                                @if (expense.type === 'HOTEL') {
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-100 pt-4">
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Hotel:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.hotelName }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Location:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.location }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Check-in:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.checkInDate | date }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Check-out:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.checkOutDate | date }}</span>
                                    </div>
                                </div>
                                }

                                <!-- Car Rental Specific Fields -->
                                @if (expense.type === 'CAR_RENTAL') {
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-100 pt-4">
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Vehicle:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.carName }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Pickup Location:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.pickupLocation }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Pickup Time:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.pickupDateTime | date:'medium'
                                            }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Dropoff Location:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.dropoffLocation }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Dropoff Time:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.dropoffDateTime | date:'medium'
                                            }}</span>
                                    </div>
                                </div>
                                }

                                <!-- Taxi Specific Fields -->
                                @if (expense.type === 'TAXI') {
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-100 pt-4">
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">From:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.from }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">To:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.to }}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Date & Time:</span>
                                        <span class="text-gray-900 ml-2">{{ expense.dateTime | date:'medium' }}</span>
                                    </div>
                                </div>
                                }
                            </div>
                            <button mat-icon-button color="primary" (click)="editExpense(expense)"
                                class="!rounded-full hover:bg-gray-100">
                                <mat-icon>edit</mat-icon>
                            </button>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>